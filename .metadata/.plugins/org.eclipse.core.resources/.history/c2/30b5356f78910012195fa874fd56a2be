package databaseOps;

import java.lang.reflect.Field;
import java.sql.*;
import java.util.Collection;
import java.util.TreeMap;

import models.IDbModel;

public abstract class DatabaseOp {
	protected IDbModel table;
	protected String stmt;
	protected Statement sql;
	protected Field[] fields;
	protected Class<? extends IDbModel> entity;
	protected TreeMap<String, String> values;
	protected String tableName;
	
	protected DatabaseOp(Statement sql, IDbModel table) throws IllegalArgumentException, IllegalAccessException{
		this.sql = sql;
		this.table = table;
		entity = table.getClass();
		fields = entity.getFields();
		tableName = entity.getSimpleName();
		values = new  TreeMap<String, String>();
		for (Field field : fields){
			String name = field.getName();
			Object value = field.get(entity);
			values.put(name, value.toString());
		}
	}
	
	protected String columns() {
		String columns = "";
		for (String column : values.keySet()){
			columns += column+",";
		}
		return removeLastComma(columns);
	}

	protected Collection<String> values() {
		return values.values();
	}
	
	private String removeLastComma(String s){
		// Remove last comma
		return s.substring(0, stmt.length());
	}
	
	public abstract ResultSet execute() throws SQLException;
}
